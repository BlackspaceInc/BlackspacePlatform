<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="BlackspaceInc">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@Blackspace">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="shortcut icon" href="https://blackspaceinc.github.io/img/favicon.png">
<link rel="apple-touch-icon" sizes="48x48" href="/img/icons/icon-48x48.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="256x256" href="/img/icons/icon-256x256.png">
<link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Internal Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Internal Documentation Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Internal Documentation" href="/opensearch.xml"><title data-react-helmet="true">Common Configuration | Internal Documentation</title><meta data-react-helmet="true" property="og:image" content="https://blackspaceinc.github.io/img/og.png"><meta data-react-helmet="true" name="twitter:image" content="https://blackspaceinc.github.io/img/og.png"><meta data-react-helmet="true" name="twitter:description" content="Blackspace is an ecommerce platform empowering minoriting owned businesses to achieve more"><meta data-react-helmet="true" name="twitter:title" content="Introduction | Internal Documentation"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | Internal Documentation&quot;"><meta data-react-helmet="true" property="og:title" content="Common Configuration | Internal Documentation"><meta data-react-helmet="true" name="description" content="Reserve priority and space for Kubernetes resources"><meta data-react-helmet="true" property="og:description" content="Reserve priority and space for Kubernetes resources"><meta data-react-helmet="true" property="og:url" content="https://blackspaceinc.github.io/docs/checklists/backend/backend-kubernetes/common"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://blackspaceinc.github.io/docs/checklists/backend/backend-kubernetes/common"><link rel="stylesheet" href="/styles.57a3982d.css">
</head>
<body itemscope="" itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Ecommerce platform empowering minority owned businesses to achieve more">
<meta itemprop="description" content="Blackspace is an ecommerce platform empowering minoriting owned businesses to achieve more">
<meta itemprop="url" content="https://blackspaceinc.github.io">
<meta itemprop="logo" content="https://blackspaceinc.github.io/img/favicon.png">
<meta itemprop="sameAs" content="https://twitter.com/blackspace">
<meta itemprop="sameAs" content="https://www.linkedin.com/company/blackspaceInc/">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_9Wyn" href="/"><img alt="Blackspace" class="navbar__logo" src="/img/navbar/logo.ico"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Getting Started</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/guide/docker/">Docker</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/kubernetes/">Kubernetes</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/BlackspaceInc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__item--github">GitHub</a><a href="https://blackspace.slack.com/join/shared_invite/enQtNzk4Nzg4Mjc2MTE2LTEzZThjMzliMjUzMTBmYzVjYWNmM2UyNWJmNDdkMDYyZmE0ZDliZTQxN2EzNzk5MDE3Zjc1ZmJiZmFiZTIwMGY#/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__item--slack">Join Slack</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button><a class="getStarted_1xnS button_Ni2_ button--primary_316O button--uppercase_35Ce button--xsmall_3jz_" href="/getstarted/">Get Started</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_9Wyn" href="/"><img alt="Blackspace" class="navbar__logo" src="/img/navbar/logo.ico"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/docker/">Docker</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/kubernetes/">Kubernetes</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/introduction/">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/BlackspaceInc/" target="_blank" rel="noopener noreferrer" class="menu__link navbar__item--github">GitHub</a></li><li class="menu__list-item"><a href="https://blackspace.slack.com/join/shared_invite/enQtNzk4Nzg4Mjc2MTE2LTEzZThjMzliMjUzMTBmYzVjYWNmM2UyNWJmNDdkMDYyZmE0ZDliZTQxN2EzNzk5MDE3Zjc1ZmJiZmFiZTIwMGY#/" target="_blank" rel="noopener noreferrer" class="menu__link navbar__item--slack">Join Slack</a></li></ul></div></div></div></nav><div class="wrapper_1hNx"><div class="doc_2sKW"><div class="docs-sidebar doc__sidebar_1koD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guidelines (DEV ONLY)</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Templates</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/template/guide">Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/template/function">Function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/template/sql">SQL</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/naming-convention">Naming convention</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/content-hierarchy">Content hierarchy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/lexicon">Lexicon</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/markdown">Markdown</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/__guidelines/influences">Influences</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Learning</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Distributed Systems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/learning/distributed-systems/big-data">Big Data Architectural Patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/learning/distributed-systems/distributed-systems">Distributed Systems Learning Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/learning/distributed-systems/patterns">Architectural Patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/learning/scalability/scalability">Scalable Systems Resources</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Checklists</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Backend</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-kubernetes/application-development">Application Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-kubernetes/best-practices">Best Practices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-kubernetes/cluster-configuration">Cluster Configuration</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/checklists/backend/backend-kubernetes/common">Common Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-kubernetes/governance">Namespace Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-kubernetes/patterns">Patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-production-ready/production-ready-checklist">Production Ready Checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/checklists/backend/backend-security-checklist/production-security-checklist">Security Checklist</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Frontend</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/checklists/frontend/frontend-design-checklist/frontend-design-checklist">Design Checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/checklists/frontend/frontend-performance-checklist/frontend-performance-checklist">Performance Checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/checklists/frontend/frontend-prod-checklist/frontend-prod-checklist">Production Ready Checklist</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Technology</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/architecture/instrumentation/instrumentation">Instrumentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/architecture/metrics/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/architecture/service-architecture/service-architecture">Service Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/architecture/service-mesh/service-mesh">Service-Mesh (Linkerd/istio)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Backend Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/backend-services/authentication-service/authentication-service">Authentication Microservice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/backend-services/company-service/company-service">Company Microservice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/backend-services/email-service/email-service">Email Microservice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/backend-services/user-service/user-service">User Microservice</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Deployments</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/deployments/deployments">Deployment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">System Benchmarks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/system-benchmarks/system-benchmark">System Benchmarks</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Third Party API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/technology/third-party-apis/third-party-apis">Third Party Api&#x27;s</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Setting up Blackspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/docker">Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide/kubernetes">Kubernetes</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Roadmap</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Product Roadmaps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/roadmap/blackspace-ecommerce/ecommerce-roadmap">Ecommerce Roadmap</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Products</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/ads/ads">Ads</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/analytics/analytics">Analytics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/business/business">Business</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/integration/integration">Integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/makers/makers">Makers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/marketplace/marketplace">Marketplace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/research/research">Research</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/vc/vc">VC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/products/social/social">Social</a></li></ul></li></ul></li></ul></div></div></div><main class="doc__main_23K2"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Common Configuration</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reserve-priority-and-space-for-kubernetes-resources"></a>Reserve priority and space for Kubernetes resources<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reserve-priority-and-space-for-kubernetes-resources" title="Direct link to heading">#</a></h3><p>Kubelet can be instructed to reserve a certain amount of resources for the system and for Kubernetes components (kubelet itself and Docker etc).</p><p>Reserved resources are subtracted from the node&#x27;s allocatable resources. This improves scheduling and makes resource allocation/usage more transparent.</p><p>You can <a href="https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/#node-allocatable" target="_blank" rel="noopener noreferrer">explore how to reserve resources on the official documentation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="handling-long-lived-connections"></a>Handling long lived connections<a aria-hidden="true" tabindex="-1" class="hash-link" href="#handling-long-lived-connections" title="Direct link to heading">#</a></h3><p><a href="https://itnext.io/on-grpc-load-balancing-683257c5b7b3" target="_blank" rel="noopener noreferrer">https://itnext.io/on-grpc-load-balancing-683257c5b7b3</a>
<a href="https://kubernetes.io/blog/2018/11/07/grpc-load-balancing-on-kubernetes-without-tears/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/blog/2018/11/07/grpc-load-balancing-on-kubernetes-without-tears/</a></p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="building-container-images"></a>Building container images<a aria-hidden="true" tabindex="-1" class="hash-link" href="#building-container-images" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-only-base-images-from-trusted-image-providers"></a>Use only base images from trusted image providers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-only-base-images-from-trusted-image-providers" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="minimise-image-sizesbuild-scratch-images"></a>Minimise image sizes/build &quot;scratch&quot; images<a aria-hidden="true" tabindex="-1" class="hash-link" href="#minimise-image-sizesbuild-scratch-images" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="image-tags-are-immutable"></a>Image tags are immutable<a aria-hidden="true" tabindex="-1" class="hash-link" href="#image-tags-are-immutable" title="Direct link to heading">#</a></h3><p>If the content of an image changes, the image tag must change too.</p><p>Common strategies are to use the Git commit hash or the CI build ID as part of the image tag. Can be combined with semantic versioning.</p><p>For example: <code>v1.0.1-bfeda01f</code></p><p><strong>Avoid the <code>latest</code> tag</strong></p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deploying-applications"></a>Deploying applications<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploying-applications" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-an-ingress-for-routing-traffic-to-your-app"></a>Use an Ingress for routing traffic to your app<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-an-ingress-for-routing-traffic-to-your-app" title="Direct link to heading">#</a></h3><p>Even for simple applications.</p><p>Requires installation of an <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noopener noreferrer">Ingress controller</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="set-a-poddisruptionbudgets-for-your-applications"></a>Set a PodDisruptionBudgets for your applications<a aria-hidden="true" tabindex="-1" class="hash-link" href="#set-a-poddisruptionbudgets-for-your-applications" title="Direct link to heading">#</a></h3><p>TODO: integrate with current &quot;Set pod disruption budgets&quot; in &quot;Fault tolerance&quot; (application development)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="all-services-that-dont-need-to-be-accessed-from-outside-the-cluster-should-be-clusterip"></a>All services that don&#x27;t need to be accessed from outside the cluster should be ClusterIP<a aria-hidden="true" tabindex="-1" class="hash-link" href="#all-services-that-dont-need-to-be-accessed-from-outside-the-cluster-should-be-clusterip" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="secure-ingress-endpoints-with-tls"></a>Secure Ingress endpoints with TLS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#secure-ingress-endpoints-with-tls" title="Direct link to heading">#</a></h3><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="user-management"></a>User management<a aria-hidden="true" tabindex="-1" class="hash-link" href="#user-management" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-an-external-identity-system-for-user-management"></a>Use an external identity system for user management<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-an-external-identity-system-for-user-management" title="Direct link to heading">#</a></h3><p>For example, Azure Active Directory, AWS IAM.</p><p>Authentication with bearer token and API server validates token with the external service</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="additional-services"></a>Additional services<a aria-hidden="true" tabindex="-1" class="hash-link" href="#additional-services" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="run-your-own-container-registry"></a>Run your own container registry<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-your-own-container-registry" title="Direct link to heading">#</a></h3><p>TODO: is this a best practice?</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="if-you-use-helm-run-your-own-helm-chart-registry"></a>If you use Helm, run your own Helm chart registry<a aria-hidden="true" tabindex="-1" class="hash-link" href="#if-you-use-helm-run-your-own-helm-chart-registry" title="Direct link to heading">#</a></h3><p>Chartmuseum, Artifactory</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pod-networking"></a>Pod networking<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pod-networking" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Network policies&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-networkpolicy-to-restrict-the-communication-between-pods"></a>Use NetworkPolicy to restrict the communication between Pods<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-networkpolicy-to-restrict-the-communication-between-pods" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-a-deny-all-network-policy-in-all-namespaces"></a>Create a deny-all network policy in all namespaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-deny-all-network-policy-in-all-namespaces" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="avoid-inter-pod-communication-across-namespaces"></a>Avoid inter-Pod communication across namespaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#avoid-inter-pod-communication-across-namespaces" title="Direct link to heading">#</a></h3><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pod-security"></a>Pod security<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pod-security" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Pod security policies&quot; (governance)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-podsecuritypolicy-to-enforce-security-features-in-all-pods"></a>Use PodSecurityPolicy to enforce security features in all Pods<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-podsecuritypolicy-to-enforce-security-features-in-all-pods" title="Direct link to heading">#</a></h3><ul><li>Using PodSecurityPolicies requires the PodSecurityPolicy admission controller to be enabled, but in most Kubernetes deployments it is not enabled. As soon as the PodSecurityPolicy admission controller is enabled, you need appropriate PodSecurityPolicy resources to allow any Pods to be created.<ul><li>You also need to grant &quot;use&quot; access to the created PodSecurityPolicies to the service account of the workload or the controller of the workload (you can use  <code>system:serviceaccounts</code> group which compromises all controller service accounts).</li></ul></li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="general-policies"></a>General policies<a aria-hidden="true" tabindex="-1" class="hash-link" href="#general-policies" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Custom policies&quot; (governance)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-open-policy-agent-opa-and-gatekeeper-to-enfore-custom-policies-on-all-resources"></a>Use Open Policy Agent (OPA) and Gatekeeper to enfore custom policies on all resources<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-open-policy-agent-opa-and-gatekeeper-to-enfore-custom-policies-on-all-resources" title="Direct link to heading">#</a></h3><p>Only allow compliant Kubernetes resources (of any kind) to be applied to the cluster (compliant with the defined policies).</p><ul><li>Open Policy Agent (OPA): policy engine</li><li>Gatekeeper<ul><li>Validating admission control webhook</li><li>Kubernetes Operator for installing, configuring and managing Open Policy Agent policies</li></ul></li></ul><p>Example policies that can be implemented with Gatekeeper:</p><ul><li>Services must not be exposed publicly on the internet</li><li>Allow containers only from trusted container registries</li><li>All containers must have resource limits</li><li>Ingress hostnames must not overlap</li><li>Ingresses must use only HTTPs</li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stateful-applications"></a>Stateful applications<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stateful-applications" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="avoid-managing-state-in-kubernetes-if-possible"></a>Avoid managing state in Kubernetes, if possible<a aria-hidden="true" tabindex="-1" class="hash-link" href="#avoid-managing-state-in-kubernetes-if-possible" title="Direct link to heading">#</a></h3><p>Use storage services outside the cluster (e.g. Amazon DynamodDB, Amazon S3).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-a-default-storageclass-named-default"></a>Create a default StorageClass named &quot;default&quot;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-default-storageclass-named-default" title="Direct link to heading">#</a></h3><p>Because this name is often the default in Helm charts.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prefer-operators-for-running-stateful-applications-rather-than-managing-it-yourself"></a>Prefer operators for running stateful applications rather than managing it yourself<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prefer-operators-for-running-stateful-applications-rather-than-managing-it-yourself" title="Direct link to heading">#</a></h3><p>Many stateful applications (e.g. databases) have operators that make it easier to run and manage them reliably.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="admission-controllers"></a>Admission controllers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#admission-controllers" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-the-officially-recommended-set-of-admission-controllers"></a>Use the officially recommended set of admission controllers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-the-officially-recommended-set-of-admission-controllers" title="Direct link to heading">#</a></h3><p>Recommended set of admission controllers to be enabled: <code>NamespaceLifecycle, LimitRanger, ServiceAccount, DefaultStorageClass, DefaultTolerationSeconds, MutatingAdmissionWebhook, ValidatingAdmissionWebhook, Priority, ResourceQuota, PodSecurityPolicy</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="if-you-use-multiple-mutating-admission-webhook-make-sure-that-they-dont-modify-the-same-fields-of-a-resource"></a>If you use multiple mutating admission webhook, make sure that they don&#x27;t modify the same fields of a resource<a aria-hidden="true" tabindex="-1" class="hash-link" href="#if-you-use-multiple-mutating-admission-webhook-make-sure-that-they-dont-modify-the-same-fields-of-a-resource" title="Direct link to heading">#</a></h3><p>They would undo each other&#x27;s actions. Furthermore, the order in which admission webhooks run is undefined.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="if-you-use-create-a-mutating-admission-webhook-also-create-a-validating-admission-webhook-that-validates-the-mutations"></a>If you use create a mutating admission webhook, also create a validating admission webhook that validates the mutations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#if-you-use-create-a-mutating-admission-webhook-also-create-a-validating-admission-webhook-that-validates-the-mutations" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="restrict-the-request-to-be-sent-to-an-admission-webhook-to-the-minimum"></a>Restrict the request to be sent to an admission webhook to the minimum<a aria-hidden="true" tabindex="-1" class="hash-link" href="#restrict-the-request-to-be-sent-to-an-admission-webhook-to-the-minimum" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scope-admission-webhooks-to-specific-namespaces"></a>Scope admission webhooks to specific namespaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scope-admission-webhooks-to-specific-namespaces" title="Direct link to heading">#</a></h3><p>Using the <code>namespaceSelector</code> field in the MutatingWebhookConfiguration/ValidatingWebhookConfiguration resource.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="always-exclude-the-kube-system-namespace-from-the-scope-of-a-custom-admission-webhook"></a>Always exclude the kube-system namespace from the scope of a custom admission webhook<a aria-hidden="true" tabindex="-1" class="hash-link" href="#always-exclude-the-kube-system-namespace-from-the-scope-of-a-custom-admission-webhook" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="restrict-rbac-rules-for-creating-admission-webhook-configuration"></a>Restrict RBAC rules for creating admission webhook configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#restrict-rbac-rules-for-creating-admission-webhook-configuration" title="Direct link to heading">#</a></h3><p>Restrict &quot;create&quot; on MutatingWebhookConfiguration/ValidatingWebhookConfiguration resources.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="managing-yaml-resource-manifests"></a>Managing YAML resource manifests<a aria-hidden="true" tabindex="-1" class="hash-link" href="#managing-yaml-resource-manifests" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="if-you-deploy-to-multiple-environments-use-a-templating-system"></a>If you deploy to multiple environments, use a templating system<a aria-hidden="true" tabindex="-1" class="hash-link" href="#if-you-deploy-to-multiple-environments-use-a-templating-system" title="Direct link to heading">#</a></h3><p>Do not manually maintain copies of the same YAML files for the different environments. Use a templating system like Helm, kustomize, Kapitan, ytt.</p><p>Works by defining the common structure of the YAML files once and defining values to substitute for each environment.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logging"></a>Logging<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logging" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Logging&quot; (application development) and &quot;Logging setup&quot; (cluster configuration).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="applications-write-logs-to-stdout-or-stderr-rather-than-to-files"></a>Applications write logs to stdout or stderr rather than to files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#applications-write-logs-to-stdout-or-stderr-rather-than-to-files" title="Direct link to heading">#</a></h3><p>This allows for the use of node agent based log aggregation systems rather than sidecar container based ones.</p><p>Everything a container writes to stdout or stderr is saved by the container runtime at a known location. This means that an agent running on each worker node can collect the logs of all the containers on that node and send them to the central log store.</p><p>If the container writes the logs to a file instead, the log file is local to the container and can&#x27;t be accessed by a node agent. In this case, each Pod would require a sidecar container that collects these logs and sends them to the central log store.</p><p>A node agent (for example, deployed as a DaemonSet) is more efficient and easier to manage than a sidecar container for every Pod.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-a-log-aggregation-system"></a>Use a log aggregation system<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-a-log-aggregation-system" title="Direct link to heading">#</a></h3><p>Cluster components and applications log to their containers, which means that logs are distributed all across the cluster. This makes it difficult to inspect the logs (probably of multiple components) to troubleshoot a problem.</p><p>A log aggregation system collects all these logs and saves them at a central place in the cluster so that you can inspect them at a single place.</p><p>Some log aggregation tools include: EFK stack (Elasticsearch, Fluentd, Kibana), Loki, DataDog, Sumo Logic, Sysdig, GCP Stackdriver, Azure Monitor, AWS CloudWatch</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-managed-log-aggregation-system-rather-than-a-self-hosted-one-if-possible"></a>Use managed log aggregation system rather than a self-hosted one (if possible)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-managed-log-aggregation-system-rather-than-a-self-hosted-one-if-possible" title="Direct link to heading">#</a></h3><p>The operational overhead of running your own log aggregation system can be come quite large. This is because for running a log aggregation system, you need to take care of things like persistent storage, backups, archival, log rotation, etc.</p><p>With a hosted log aggregation solution, all these things are taken care of for you and there are fewer things that can go wrong.</p><p>Some hosted log aggregation systems include: DataDog, Sumo Logic, Sysdig, GCP Stackdriver, Azure Monitor, AWS CloudWatch</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="define-a-log-retention-and-archival-strategy"></a>Define a log retention and archival strategy<a aria-hidden="true" tabindex="-1" class="hash-link" href="#define-a-log-retention-and-archival-strategy" title="Direct link to heading">#</a></h3><p>How long to retain logs in the log store and what to do with them afterwards?</p><p>As a general rule, retaining logs for 30-45 day in the log store is a reasonable value. After that, if the logs should still be available, you can move them to a cost-efficient archiving storage (e.g. <a href="https://aws.amazon.com/glacier/" target="_blank" rel="noopener noreferrer">Amazon Glacier</a>).</p><p>Take into account any regulatory and internal compliance in your organisation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="collect-logs-from-both-cluster-components-and-applications"></a>Collect logs from both cluster components and applications<a aria-hidden="true" tabindex="-1" class="hash-link" href="#collect-logs-from-both-cluster-components-and-applications" title="Direct link to heading">#</a></h3><p>Your applications are not the only components that produce logs in your cluster — all the cluster components do as well, and you should collect their logs too.</p><p>Here are some of the cluster components whose logs you should also have in your log aggregation system:</p><ul><li>All nodes: kubelet, container runtime</li><li>Master nodes: API server, scheduler, controller mananger</li><li>(Kubernetes auditing (all requests to the API server))</li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="monitoring"></a>Monitoring<a aria-hidden="true" tabindex="-1" class="hash-link" href="#monitoring" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="set-up-extensive-monitoring-in-your-cluster"></a>Set up extensive monitoring in your cluster<a aria-hidden="true" tabindex="-1" class="hash-link" href="#set-up-extensive-monitoring-in-your-cluster" title="Direct link to heading">#</a></h3><p>TODO: what kind of advice to give in this item?</p><p>Monitoring is the collection and aggregation of measurements from different components of your cluster. It is extremely important for gaining insight into the internals of your cluster, assessing its health, and detecting and troubleshooting problems, and even preventing them before they occur.</p><p>Monitoring consists of two parts:</p><ol><li>Components make measurements and expose them as metrics</li><li>The monitoring system periodically collects these metrics</li></ol><p>Some monitoring systems include:</p><ul><li>Self-hosted: Prometheus</li><li>Managed: DataDog, Sumo Logic, Sysdig, Google Stackdriver, Azure Monitor, Azure Monitor for Containers, AWS CloudWatch, AWS Container Insights</li></ul><p><em>What should you monitor?</em></p><p>Exactly what metrics to collect depends on the components in your cluster (i.e. what metrics they expose). </p><p>There are some general guidelines as to the <em>types</em> of metrics to collect:</p><ul><li>Infrastructure (e.g. nodes): USE metrics — Usage, Saturation, Errors</li><li>Applications: RED  metrics — Rate, Errors, Duration</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="if-you-use-a-self-hosted-monitoring-system-run-it-in-a-dedicated-management-cluster"></a>If you use a self-hosted monitoring system, run it in a dedicated management cluster<a aria-hidden="true" tabindex="-1" class="hash-link" href="#if-you-use-a-self-hosted-monitoring-system-run-it-in-a-dedicated-management-cluster" title="Direct link to heading">#</a></h3><p>You could run the monitoring system in the production cluster itself. However, if there is a problem with the cluster, the monitoring system might be affected as well (and you might <em>need</em> the monitoring system to troubleshoot the problem with the cluster).</p><p>To avoid this, you can create a dedicated cluster that only runs management tools (such as the monitoring system) for all your other clusters.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="alerting"></a>Alerting<a aria-hidden="true" tabindex="-1" class="hash-link" href="#alerting" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="only-alert-on-events-that-require-immediate-human-intervention"></a>Only alert on events that require immediate human intervention<a aria-hidden="true" tabindex="-1" class="hash-link" href="#only-alert-on-events-that-require-immediate-human-intervention" title="Direct link to heading">#</a></h3><p>Omit alerts that don&#x27;t require a human to take action right away. Too many unimportant alerts cause &quot;alert fatigue&quot; and cause important alerts to be ignored.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="focus-on-alerts-that-affect-your-service-level-objectives-slos"></a>Focus on alerts that affect your service level objectives (SLOs)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#focus-on-alerts-that-affect-your-service-level-objectives-slos" title="Direct link to heading">#</a></h3><p>The core of your alerts should be on incidents that negatively affect the service level that you promised to your customers. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="automate-remediation-of-all-non-critical-alerts"></a>Automate remediation of all non-critical alerts<a aria-hidden="true" tabindex="-1" class="hash-link" href="#automate-remediation-of-all-non-critical-alerts" title="Direct link to heading">#</a></h3><p>All incidents that don&#x27;t merit an alert (because they don&#x27;t require immediate human intervention, or they don&#x27;t affect the customer experience) should be handled automatically (invest in automation).</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-and-secrets"></a>Configuration and secrets<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-and-secrets" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Configuration and secrets&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="separate-all-configuration-from-the-application-code"></a>Separate all configuration from the application code<a aria-hidden="true" tabindex="-1" class="hash-link" href="#separate-all-configuration-from-the-application-code" title="Direct link to heading">#</a></h3><p>Configuration should be maintained outside the application code.</p><p>This has several benefits. First, changing the configuration does not require recompiling the application. Second, the configuration can be updated when the application is running. Third, the same code can be used in different environments.</p><p>In Kubernetes, the configuration can be saved in ConfigMaps, which can then be mounted into containers as volumes are passed in as environment variables.</p><p>Save only non-sensitive configuration in ConfigMaps. For sensitive information (such as credentials), use the Secret resource.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="save-non-critical-configuration-in-configmaps-and-critical-configuratio-in-secrets"></a>Save non-critical configuration in ConfigMaps and critical configuratio in Secrets<a aria-hidden="true" tabindex="-1" class="hash-link" href="#save-non-critical-configuration-in-configmaps-and-critical-configuratio-in-secrets" title="Direct link to heading">#</a></h3><p>Secrets are similar to ConfigMaps but have some special semantics to protect their content (e.g. content of Secrets is not displayed in some kubectl outputs)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="mount-secrets-as-volumes-not-environment-variables"></a>Mount Secrets as volumes, not environment variables<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mount-secrets-as-volumes-not-environment-variables" title="Direct link to heading">#</a></h3><p>The content of Secret resources should be mounted into containers as volumes rather than passed in as environment variables.</p><p>This is to prevent that the secret values appear in the command that was used to start the container, which may be inspected by individuals that shouldn&#x27;t have access to the secret values.</p><ul><li>Injected environment variables are always present and may become artifacts in logs for the entire system.</li><li>Secret-based environment variables should be mounted as a volume (not environment variables). In this way, they&#x27;re only available to the desired process/container. Not the whole pod.</li></ul><p>See <a href="https://twitter.com/jeyfelbrandauer/status/1194752211366088704" target="_blank" rel="noopener noreferrer">tweet</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-podpresets-to-automatically-mount-configmaps-or-secrets-into-containers"></a>Use PodPresets to automatically mount ConfigMaps or Secrets into containers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-podpresets-to-automatically-mount-configmaps-or-secrets-into-containers" title="Direct link to heading">#</a></h3><p><a href="https://kubernetes.io/docs/concepts/workloads/pods/podpreset/" target="_blank" rel="noopener noreferrer">PodPresets</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="include-version-in-configmap-and-secret-to-ensure-configuration-changes-are-reloaded"></a>Include version in ConfigMap and Secret to ensure configuration changes are reloaded<a aria-hidden="true" tabindex="-1" class="hash-link" href="#include-version-in-configmap-and-secret-to-ensure-configuration-changes-are-reloaded" title="Direct link to heading">#</a></h3><p>For example, instead of naming a ConfigMap just <code>config</code> name it <code>config-v1</code>. Whenever you update the configuration in the ConfigMap, also update the version (for example, <code>config-v2</code>). Then, update all references to the ConfigMap (for example, in a Deployment) to the new version (e.g. <code>config-v2</code>).</p><p>This causes all Pods to be restarted, whih ensures that the new configuration is indeed loaded into the Pods, regardless of whether the ConfigMap is mounted as a volume or as environment variables, and, in the latter case, regardless of whether the app watches the configuration file for changes.</p><p>You can automate this process with a CD system.</p><p>If you don&#x27;t delete the previous versions of the ConfigMap (e.g. <code>config-v1</code>), you can easily roll back to a previous configuration.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="role-based-access-control-rbac"></a>Role-based access control (RBAC)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#role-based-access-control-rbac" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Role-Based Access Control (RBAC) policies&quot; (governance)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="follow-the-least-privilege-principle-for-rbac-roles"></a>Follow the &quot;least privilege&quot; principle for RBAC roles<a aria-hidden="true" tabindex="-1" class="hash-link" href="#follow-the-least-privilege-principle-for-rbac-roles" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dont-use-catch-all-service-accounts-for-pods"></a>Don&#x27;t use &quot;catch all&quot; service accounts for Pods<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dont-use-catch-all-service-accounts-for-pods" title="Direct link to heading">#</a></h3><p>If a Pod needs to access the Kubernetes API, tailor an RBAC role that allows exactly those operatios that the Pod has to do (and nothing more), assign it to a new service account, and assign this service account to the Pod.</p><p>Don&#x27;t use an exising service account for the Pod that might have an associated role with more permissions than the Pod needs.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="labelling-resources"></a>Labelling resources<a aria-hidden="true" tabindex="-1" class="hash-link" href="#labelling-resources" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Tagging resources&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="all-resources-have-a-common-set-recommended-labels"></a>All resources have a common set recommended labels<a aria-hidden="true" tabindex="-1" class="hash-link" href="#all-resources-have-a-common-set-recommended-labels" title="Direct link to heading">#</a></h3><p><strong>What?</strong></p><p>The <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/" target="_blank" rel="noopener noreferrer">Kubernetes documentation</a> recommends a set of common labels to be applied to all resource objects.</p><p><strong>Why?</strong></p><p>Having a set of common labels allows third-party tools to interoperate with the resources in your cluster. Furthermore, a common set of labels facilitates and standardises manual management of the resources.</p><p><strong>How?</strong></p><p>The recommended labels are:</p><ul><li><code>app.kubernetes.io/name</code>: the name of the application</li><li><code>app.kubernetes.io/instance</code>: a unique name identifying the instance of an application</li><li><code>app.kubernetes.io/version</code>: the current version of the application (e.g., a semantic version, revision hash, etc.)</li><li><code>app.kubernetes.io/component</code>: the component within the architecture</li><li><code>app.kubernetes.io/part-of</code>: the name of a higher level application this one is part of</li><li><code>app.kubernetes.io/managed-by</code>: the tool being used to manage the operation of an application</li></ul><p>Here is an example of applying these labels to a StatefulSet resource:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> apps/v1</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> StatefulSet</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">abcxyz</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  labels</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">**</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> mysql</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">abcxzy</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;5.7.21&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> database</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> wordpress</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/managed-by</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> helm</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> mysql</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">abcxzy</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;5.7.21&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> database</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> wordpress</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app.kubernetes.io/managed-by</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> helm</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4"># ...</span></div></div></div></div></div><p>Note that depending on the application, only some of these labels may be defined (for example, <code>app.kubernetes.io/name</code> and <code>app.kubernetes.io/instance</code>), but they should be applied to <em>all</em> resource objects.</p><p><strong>References</strong></p><ul><li><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/" target="_blank" rel="noopener noreferrer">Kubernetes documentation: Recommended Labels</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-independent-versions-for-containers-pods-and-apps"></a>Use independent versions for containers, Pods, and apps<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-independent-versions-for-containers-pods-and-apps" title="Direct link to heading">#</a></h3><p>E.g. if Pod specification changes, update only the Pod and app version, but not the container image version, etc.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="maintain-a-release-for-top-level-resources"></a>Maintain a &quot;release&quot; for top-level resources<a aria-hidden="true" tabindex="-1" class="hash-link" href="#maintain-a-release-for-top-level-resources" title="Direct link to heading">#</a></h3><p>Resources that compromise an entire app (e.g. Deployment, StatefulSet) should have a <code>release</code> label.</p><p>This label should change every time the application is deployed (the release should be updated even if the version of the app stays the same).</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resource-management"></a>Resource management<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resource-management" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Resource utilisation&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="define-resource-requests-for-all-containers"></a>Define resource requests for all containers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#define-resource-requests-for-all-containers" title="Direct link to heading">#</a></h3><p><strong>What?</strong></p><p>You can set a resource request (CPU and memory) for each container of a Pod in the Pod specification.</p><p><strong>Why?</strong></p><p>The <strong>request</strong> for a resource is the minimum amount of resource the container needs for running. It influences the scheduling decision of the Kubernetes scheduler (the scheduler schedules a pod only to a node that has enough free resources to accommodate the requests of all the containers of the pod).</p><p>By default, no resource requests are set, which means that the scheduler schedules a pod to any node, no matter how many free resources it has.</p><p>Setting requests for memory and CPU for each container of a Pod ensures that the Pod is able to run properly on the node it is scheduled to.</p><p><strong>How?</strong></p><p>Set the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.16/#resourcerequirements-v1-core" target="_blank" rel="noopener noreferrer"><code>pod.spec.containers[].resources.requests</code></a> field of a Pod specification:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> apps/v1</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Deployment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> test</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> nginx</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> nginx</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 100Mi</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 100m</span></div></div></div></div></div><p><strong>References</strong></p><ul><li><a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener noreferrer">Kubernetes documentation: Managing Compute Resources for Containers</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="define-resource-limits-according-to-the-desired-quality-of-service-qos-class"></a>Define resource limits according to the desired Quality of Service (QoS) class<a aria-hidden="true" tabindex="-1" class="hash-link" href="#define-resource-limits-according-to-the-desired-quality-of-service-qos-class" title="Direct link to heading">#</a></h3><p>The <strong>limit</strong> for a resource is the maximum amount of the resource that the container is allowed to use (you can think of it as an upper cap for resource usage bursts). What happens when a container reaches the limit, depends on the type of resource:</p><ul><li>For memory, the container is killed and restarted</li><li>For CPU, the container is throttled (TODO: what does &quot;throttled&quot; mean exactly?)</li></ul><p>By default, no resource limits are set, which means that there&#x27;s no limit of how much resources a pod may use on a node.</p><p>Setting a resource limits prevents Pods from monopolising all the resources on node.</p><p>Given a value for the resource request, the value for the resoruce limit determines the Quality of Service (QoS) class of the Pod:</p><ul><li>Best-effort: no requests and limits, lowest priority, Pod is killed first</li><li>Burstable: limits are higher than requests, middle-priority, killed if no Best-effort Pods exist</li><li>Guaranteed: limits equal requests, highest priority, killed only if no Best-effort and Burstable Pods exist</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dont-define-cpu-limits"></a>Don&#x27;t define CPU limits<a aria-hidden="true" tabindex="-1" class="hash-link" href="#dont-define-cpu-limits" title="Direct link to heading">#</a></h3><p>TODO: how does this affect the QoS class? Where&#x27;s the source that this is a best practice?</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-a-limitrange-for-each-namespace"></a>Create a LimitRange for each namespace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-limitrange-for-each-namespace" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-a-resourcequota-for-each-namespace"></a>Create a ResourceQuota for each namespace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-resourcequota-for-each-namespace" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-priorityclass-to-define-the-order-in-which-pods-are-scheduled-and-evicted"></a>Use PriorityClass to define the order in which Pods are scheduled and evicted<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-priorityclass-to-define-the-order-in-which-pods-are-scheduled-and-evicted" title="Direct link to heading">#</a></h3><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="health-checks"></a>Health checks<a aria-hidden="true" tabindex="-1" class="hash-link" href="#health-checks" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Health checks&quot;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="set-initialdelayseconds-to-appropriate-value-for-all-liveness-and-readiness-probes"></a>Set initialDelaySeconds to appropriate value for all liveness and readiness probes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#set-initialdelayseconds-to-appropriate-value-for-all-liveness-and-readiness-probes" title="Direct link to heading">#</a></h3><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="advanced-scheduling"></a>Advanced scheduling<a aria-hidden="true" tabindex="-1" class="hash-link" href="#advanced-scheduling" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-pod-affinity-if-certain-pods-should-be-colocated"></a>Use Pod Affinity if certain Pods should be colocated<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-pod-affinity-if-certain-pods-should-be-colocated" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-pod-anti-affinity-if-certain-pods-should-not-be-colocated"></a>Use Pod Anti-affinity if certain Pods should not be colocated<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-pod-anti-affinity-if-certain-pods-should-not-be-colocated" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-node-affinity-or-node-selector-if-a-pod-should-run-only-on-a-subset-of-nodes"></a>Use Node Affinity or Node Selector if a Pod should run only on a subset of nodes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-node-affinity-or-node-selector-if-a-pod-should-run-only-on-a-subset-of-nodes" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-taints-and-tolerations-to-reserve-nodes-for-certain-pods"></a>Use Taints and Tolerations to reserve nodes for certain Pods<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-taints-and-tolerations-to-reserve-nodes-for-certain-pods" title="Direct link to heading">#</a></h3><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="application-lifecycle"></a>Application lifecycle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#application-lifecycle" title="Direct link to heading">#</a></h2><p>TODO: integrate with current &quot;Graceful shutdown&quot; (rename it &quot;Application lifecycle&quot;)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="container-listens-for-sigterm-signal-and-shuts-down-gracefully"></a>Container listens for SIGTERM signal and shuts down gracefully<a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-listens-for-sigterm-signal-and-shuts-down-gracefully" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="container-implements-prestop-lifecycle-hook-to-shut-down-gracefully"></a>Container implements preStop lifecycle hook to shut down gracefully<a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-implements-prestop-lifecycle-hook-to-shut-down-gracefully" title="Direct link to heading">#</a></h3><p>This is an alternative to listening for the SIGTERM signal.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="set-the-termination-grace-period-if-gracefully-shutting-down-takes-very-long"></a>Set the termination grace period if gracefully shutting down takes very long<a aria-hidden="true" tabindex="-1" class="hash-link" href="#set-the-termination-grace-period-if-gracefully-shutting-down-takes-very-long" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="container-implements-poststart-lifecycle-hook-to-do-any-start-up-tasks"></a>Container implements postStart lifecycle hook to do any start-up tasks<a aria-hidden="true" tabindex="-1" class="hash-link" href="#container-implements-poststart-lifecycle-hook-to-do-any-start-up-tasks" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="only-use-the-exec-method-for-the-poststart-lifecycle-hook"></a>Only use the exec method for the postStart lifecycle hook<a aria-hidden="true" tabindex="-1" class="hash-link" href="#only-use-the-exec-method-for-the-poststart-lifecycle-hook" title="Direct link to heading">#</a></h3><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="amazon-web-services-aws"></a>Amazon Web Services (AWS)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#amazon-web-services-aws" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="use-kube2iam-to-integrate-kubernetes-permissions-with-aws-iam"></a>Use kube2iam to integrate Kubernetes permissions with AWS IAM<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-kube2iam-to-integrate-kubernetes-permissions-with-aws-iam" title="Direct link to heading">#</a></h3><p>As a best practice to use this, I would recommend using <a href="https://github.com/jtblin/kube2iam" target="_blank" rel="noopener noreferrer">kube2iam</a> -- this allows you to control which IAM roles a pod is allowed to assume based on namespace, but also allows the pod to see itself as having the role vs requiring it to assume such a role.</p><p>In our setup we use kube2iam and assign nodes their IAM role - this IAM role is allowed to assume other roles. With kube2iam, we assign the role through a pod annotation, so the pod sees itself as having that role. Additionally we use namespace restrictions to control access to which roles a pod is allowed to assume.</p><p>See #7</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/checklists/backend/backend-kubernetes/cluster-configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Cluster Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/checklists/backend/backend-kubernetes/governance"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Namespace Management »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reserve-priority-and-space-for-kubernetes-resources" class="table-of-contents__link">Reserve priority and space for Kubernetes resources</a></li><li><a href="#handling-long-lived-connections" class="table-of-contents__link">Handling long lived connections</a></li><li><a href="#building-container-images" class="table-of-contents__link">Building container images</a><ul><li><a href="#use-only-base-images-from-trusted-image-providers" class="table-of-contents__link">Use only base images from trusted image providers</a></li><li><a href="#minimise-image-sizesbuild-scratch-images" class="table-of-contents__link">Minimise image sizes/build &quot;scratch&quot; images</a></li><li><a href="#image-tags-are-immutable" class="table-of-contents__link">Image tags are immutable</a></li></ul></li><li><a href="#deploying-applications" class="table-of-contents__link">Deploying applications</a><ul><li><a href="#use-an-ingress-for-routing-traffic-to-your-app" class="table-of-contents__link">Use an Ingress for routing traffic to your app</a></li><li><a href="#set-a-poddisruptionbudgets-for-your-applications" class="table-of-contents__link">Set a PodDisruptionBudgets for your applications</a></li><li><a href="#all-services-that-dont-need-to-be-accessed-from-outside-the-cluster-should-be-clusterip" class="table-of-contents__link">All services that don&#39;t need to be accessed from outside the cluster should be ClusterIP</a></li><li><a href="#secure-ingress-endpoints-with-tls" class="table-of-contents__link">Secure Ingress endpoints with TLS</a></li></ul></li><li><a href="#user-management" class="table-of-contents__link">User management</a><ul><li><a href="#use-an-external-identity-system-for-user-management" class="table-of-contents__link">Use an external identity system for user management</a></li></ul></li><li><a href="#additional-services" class="table-of-contents__link">Additional services</a><ul><li><a href="#run-your-own-container-registry" class="table-of-contents__link">Run your own container registry</a></li><li><a href="#if-you-use-helm-run-your-own-helm-chart-registry" class="table-of-contents__link">If you use Helm, run your own Helm chart registry</a></li></ul></li><li><a href="#pod-networking" class="table-of-contents__link">Pod networking</a><ul><li><a href="#use-networkpolicy-to-restrict-the-communication-between-pods" class="table-of-contents__link">Use NetworkPolicy to restrict the communication between Pods</a></li><li><a href="#create-a-deny-all-network-policy-in-all-namespaces" class="table-of-contents__link">Create a deny-all network policy in all namespaces</a></li><li><a href="#avoid-inter-pod-communication-across-namespaces" class="table-of-contents__link">Avoid inter-Pod communication across namespaces</a></li></ul></li><li><a href="#pod-security" class="table-of-contents__link">Pod security</a><ul><li><a href="#use-podsecuritypolicy-to-enforce-security-features-in-all-pods" class="table-of-contents__link">Use PodSecurityPolicy to enforce security features in all Pods</a></li></ul></li><li><a href="#general-policies" class="table-of-contents__link">General policies</a><ul><li><a href="#use-open-policy-agent-opa-and-gatekeeper-to-enfore-custom-policies-on-all-resources" class="table-of-contents__link">Use Open Policy Agent (OPA) and Gatekeeper to enfore custom policies on all resources</a></li></ul></li><li><a href="#stateful-applications" class="table-of-contents__link">Stateful applications</a><ul><li><a href="#avoid-managing-state-in-kubernetes-if-possible" class="table-of-contents__link">Avoid managing state in Kubernetes, if possible</a></li><li><a href="#create-a-default-storageclass-named-default" class="table-of-contents__link">Create a default StorageClass named &quot;default&quot;</a></li><li><a href="#prefer-operators-for-running-stateful-applications-rather-than-managing-it-yourself" class="table-of-contents__link">Prefer operators for running stateful applications rather than managing it yourself</a></li></ul></li><li><a href="#admission-controllers" class="table-of-contents__link">Admission controllers</a><ul><li><a href="#use-the-officially-recommended-set-of-admission-controllers" class="table-of-contents__link">Use the officially recommended set of admission controllers</a></li><li><a href="#if-you-use-multiple-mutating-admission-webhook-make-sure-that-they-dont-modify-the-same-fields-of-a-resource" class="table-of-contents__link">If you use multiple mutating admission webhook, make sure that they don&#39;t modify the same fields of a resource</a></li><li><a href="#if-you-use-create-a-mutating-admission-webhook-also-create-a-validating-admission-webhook-that-validates-the-mutations" class="table-of-contents__link">If you use create a mutating admission webhook, also create a validating admission webhook that validates the mutations</a></li><li><a href="#restrict-the-request-to-be-sent-to-an-admission-webhook-to-the-minimum" class="table-of-contents__link">Restrict the request to be sent to an admission webhook to the minimum</a></li><li><a href="#scope-admission-webhooks-to-specific-namespaces" class="table-of-contents__link">Scope admission webhooks to specific namespaces</a></li><li><a href="#always-exclude-the-kube-system-namespace-from-the-scope-of-a-custom-admission-webhook" class="table-of-contents__link">Always exclude the kube-system namespace from the scope of a custom admission webhook</a></li><li><a href="#restrict-rbac-rules-for-creating-admission-webhook-configuration" class="table-of-contents__link">Restrict RBAC rules for creating admission webhook configuration</a></li></ul></li><li><a href="#managing-yaml-resource-manifests" class="table-of-contents__link">Managing YAML resource manifests</a><ul><li><a href="#if-you-deploy-to-multiple-environments-use-a-templating-system" class="table-of-contents__link">If you deploy to multiple environments, use a templating system</a></li></ul></li><li><a href="#logging" class="table-of-contents__link">Logging</a><ul><li><a href="#applications-write-logs-to-stdout-or-stderr-rather-than-to-files" class="table-of-contents__link">Applications write logs to stdout or stderr rather than to files</a></li><li><a href="#use-a-log-aggregation-system" class="table-of-contents__link">Use a log aggregation system</a></li><li><a href="#use-managed-log-aggregation-system-rather-than-a-self-hosted-one-if-possible" class="table-of-contents__link">Use managed log aggregation system rather than a self-hosted one (if possible)</a></li><li><a href="#define-a-log-retention-and-archival-strategy" class="table-of-contents__link">Define a log retention and archival strategy</a></li><li><a href="#collect-logs-from-both-cluster-components-and-applications" class="table-of-contents__link">Collect logs from both cluster components and applications</a></li></ul></li><li><a href="#monitoring" class="table-of-contents__link">Monitoring</a><ul><li><a href="#set-up-extensive-monitoring-in-your-cluster" class="table-of-contents__link">Set up extensive monitoring in your cluster</a></li><li><a href="#if-you-use-a-self-hosted-monitoring-system-run-it-in-a-dedicated-management-cluster" class="table-of-contents__link">If you use a self-hosted monitoring system, run it in a dedicated management cluster</a></li></ul></li><li><a href="#alerting" class="table-of-contents__link">Alerting</a><ul><li><a href="#only-alert-on-events-that-require-immediate-human-intervention" class="table-of-contents__link">Only alert on events that require immediate human intervention</a></li><li><a href="#focus-on-alerts-that-affect-your-service-level-objectives-slos" class="table-of-contents__link">Focus on alerts that affect your service level objectives (SLOs)</a></li><li><a href="#automate-remediation-of-all-non-critical-alerts" class="table-of-contents__link">Automate remediation of all non-critical alerts</a></li></ul></li><li><a href="#configuration-and-secrets" class="table-of-contents__link">Configuration and secrets</a><ul><li><a href="#separate-all-configuration-from-the-application-code" class="table-of-contents__link">Separate all configuration from the application code</a></li><li><a href="#save-non-critical-configuration-in-configmaps-and-critical-configuratio-in-secrets" class="table-of-contents__link">Save non-critical configuration in ConfigMaps and critical configuratio in Secrets</a></li><li><a href="#mount-secrets-as-volumes-not-environment-variables" class="table-of-contents__link">Mount Secrets as volumes, not environment variables</a></li><li><a href="#use-podpresets-to-automatically-mount-configmaps-or-secrets-into-containers" class="table-of-contents__link">Use PodPresets to automatically mount ConfigMaps or Secrets into containers</a></li><li><a href="#include-version-in-configmap-and-secret-to-ensure-configuration-changes-are-reloaded" class="table-of-contents__link">Include version in ConfigMap and Secret to ensure configuration changes are reloaded</a></li></ul></li><li><a href="#role-based-access-control-rbac" class="table-of-contents__link">Role-based access control (RBAC)</a><ul><li><a href="#follow-the-least-privilege-principle-for-rbac-roles" class="table-of-contents__link">Follow the &quot;least privilege&quot; principle for RBAC roles</a></li><li><a href="#dont-use-catch-all-service-accounts-for-pods" class="table-of-contents__link">Don&#39;t use &quot;catch all&quot; service accounts for Pods</a></li></ul></li><li><a href="#labelling-resources" class="table-of-contents__link">Labelling resources</a><ul><li><a href="#all-resources-have-a-common-set-recommended-labels" class="table-of-contents__link">All resources have a common set recommended labels</a></li><li><a href="#use-independent-versions-for-containers-pods-and-apps" class="table-of-contents__link">Use independent versions for containers, Pods, and apps</a></li><li><a href="#maintain-a-release-for-top-level-resources" class="table-of-contents__link">Maintain a &quot;release&quot; for top-level resources</a></li></ul></li><li><a href="#resource-management" class="table-of-contents__link">Resource management</a><ul><li><a href="#define-resource-requests-for-all-containers" class="table-of-contents__link">Define resource requests for all containers</a></li><li><a href="#define-resource-limits-according-to-the-desired-quality-of-service-qos-class" class="table-of-contents__link">Define resource limits according to the desired Quality of Service (QoS) class</a></li><li><a href="#dont-define-cpu-limits" class="table-of-contents__link">Don&#39;t define CPU limits</a></li><li><a href="#create-a-limitrange-for-each-namespace" class="table-of-contents__link">Create a LimitRange for each namespace</a></li><li><a href="#create-a-resourcequota-for-each-namespace" class="table-of-contents__link">Create a ResourceQuota for each namespace</a></li><li><a href="#use-priorityclass-to-define-the-order-in-which-pods-are-scheduled-and-evicted" class="table-of-contents__link">Use PriorityClass to define the order in which Pods are scheduled and evicted</a></li></ul></li><li><a href="#health-checks" class="table-of-contents__link">Health checks</a><ul><li><a href="#set-initialdelayseconds-to-appropriate-value-for-all-liveness-and-readiness-probes" class="table-of-contents__link">Set initialDelaySeconds to appropriate value for all liveness and readiness probes</a></li></ul></li><li><a href="#advanced-scheduling" class="table-of-contents__link">Advanced scheduling</a><ul><li><a href="#use-pod-affinity-if-certain-pods-should-be-colocated" class="table-of-contents__link">Use Pod Affinity if certain Pods should be colocated</a></li><li><a href="#use-pod-anti-affinity-if-certain-pods-should-not-be-colocated" class="table-of-contents__link">Use Pod Anti-affinity if certain Pods should not be colocated</a></li><li><a href="#use-node-affinity-or-node-selector-if-a-pod-should-run-only-on-a-subset-of-nodes" class="table-of-contents__link">Use Node Affinity or Node Selector if a Pod should run only on a subset of nodes</a></li><li><a href="#use-taints-and-tolerations-to-reserve-nodes-for-certain-pods" class="table-of-contents__link">Use Taints and Tolerations to reserve nodes for certain Pods</a></li></ul></li><li><a href="#application-lifecycle" class="table-of-contents__link">Application lifecycle</a><ul><li><a href="#container-listens-for-sigterm-signal-and-shuts-down-gracefully" class="table-of-contents__link">Container listens for SIGTERM signal and shuts down gracefully</a></li><li><a href="#container-implements-prestop-lifecycle-hook-to-shut-down-gracefully" class="table-of-contents__link">Container implements preStop lifecycle hook to shut down gracefully</a></li><li><a href="#set-the-termination-grace-period-if-gracefully-shutting-down-takes-very-long" class="table-of-contents__link">Set the termination grace period if gracefully shutting down takes very long</a></li><li><a href="#container-implements-poststart-lifecycle-hook-to-do-any-start-up-tasks" class="table-of-contents__link">Container implements postStart lifecycle hook to do any start-up tasks</a></li><li><a href="#only-use-the-exec-method-for-the-poststart-lifecycle-hook" class="table-of-contents__link">Only use the exec method for the postStart lifecycle hook</a></li></ul></li><li><a href="#amazon-web-services-aws" class="table-of-contents__link">Amazon Web Services (AWS)</a><ul><li><a href="#use-kube2iam-to-integrate-kubernetes-permissions-with-aws-iam" class="table-of-contents__link">Use kube2iam to integrate Kubernetes permissions with AWS IAM</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer_mib0 section_3Kiu"><div class="footer__inner_z0Le section--inner_2xOo"><div class="footer__column_3Npq footer__column--left_1EuR"><img alt="Blackspace logo" class="footer__logo_29Wo" src="/img/navbar/logo.ico" title="Blackspace - Fastest social ecommerce solution for minority owned businesses"><p class="footer__tagline_2F15">Blackspace is the fastest social ecommerce solution for minority owned business owners</p><a class="footer__github_8UHO button_Ni2_ button--icon_3YKU button--secondary_1x2U button--xsmall_3jz_" href="https://github.com/BlackspaceInc/" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_3Npq footer__column--right_1XPX"><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">Blackspace</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/docs/introduction/">Documentation</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/BlackspaceInc//projects/3" rel="noopener noreferrer" target="_blank">Roadmap</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">Community</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://blackspace.slack.com/join/shared_invite/enQtNzk4Nzg4Mjc2MTE2LTEzZThjMzliMjUzMTBmYzVjYWNmM2UyNWJmNDdkMDYyZmE0ZDliZTQxN2EzNzk5MDE3Zjc1ZmJiZmFiZTIwMGY#/" rel="noopener noreferrer" target="_blank">Slack</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://twitter.com/blackspace" rel="noopener noreferrer" target="_blank">Twitter</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">More</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/BlackspaceInc/" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></div></div></div><div class="footer__bottom_2RpL"><p class="footer__copyright_1o2i">Copyright © 2020 Blackspace Platform</p></div></footer></div>
<script src="/styles.d44324ef.js" defer="defer"></script>
<script src="/main.15d38a36.js" defer="defer"></script>
<script src="/common.15f28051.js" defer="defer"></script>
<script src="/1be78505.7228b8b5.js" defer="defer"></script>
<script src="/935f2afb.dc1c651c.js" defer="defer"></script>
<script src="/17896441.24ce1f02.js" defer="defer"></script>
<script src="/37621d98.c579a16c.js" defer="defer"></script>
</body>
</html>